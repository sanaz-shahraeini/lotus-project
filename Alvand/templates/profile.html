{% extends 'base.html' %}
{% load static profileTags %}

{% block head_extra %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Dashboard CSS files for sidebar integration -->
 
<link rel="stylesheet" href="{% static 'css/dashboard-fix.css' %}" />
<link rel="stylesheet" href="{% static 'css/dashboard-width-fix.css' %}" />
<link rel="stylesheet" href="{% static 'css/direct-layout-fix.css' %}" />
<link rel="stylesheet" href="{% static 'css/header-optimize.css' %}" />
<link rel="stylesheet" href="{% static 'css/dashboard-content.css' %}" />
    <style>
    /* Root variables for consistent styling */
    :root {
        --primary-color: #6366f1;
        --primary-hover: #4f46e5;
        --secondary-color: #f3f4f6;
        --text-color: #1f2937;
        --border-color: #e5e7eb;
        --sidebar-width: 135px;
        --content-padding: 1.5rem;
        --bg-color: #f9fafb;
        --card-bg: white;
    }
    
    /* Dark mode variables */
    .dark {
        --bg-color: #111827;
        --card-bg: #1f2937;
        --text-color: #f9fafb;
        --border-color: #374151;
        --secondary-color: #374151;
    }
    
    body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
    }
    
    /* Main content layout with sidebar integration */
    .main-content {
        margin-right: 0 !important;
        padding: 1rem;
        transition: all 0.3s ease;
        width: 100%;
    }
    
    @media (min-width: 1024px) {
        .main-content {
            margin-right: 135px !important;
            padding: 1.5rem;
            width: calc(100% - 135px) !important;
        }
    }
    
    /* Profile specific styling */
    .profile-card {
        background-color: var(--card-bg);
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--border-color);
        transition: background-color 0.3s, border-color 0.3s;
    }
    
    /* Form elements styling */
    .form-input {
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
        width: 100%;
        background-color: var(--card-bg);
        color: var(--text-color);
        transition: border-color 0.3s, background-color 0.3s, color 0.3s;
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }
    
    .btn-primary {
        background-color: var(--primary-color);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
        transition: background-color 0.3s;
    }
    
    .btn-primary:hover {
        background-color: var(--primary-hover);
    }
    
    /* Fix for RTL layout with sidebar */
    body[dir="rtl"] .main-content {
        margin-right: 0 !important;
        margin-left: 0 !important;
    }
    
    @media (min-width: 1024px) {
        body[dir="rtl"] .main-content {
            margin-right: 135px !important;
            margin-left: 0 !important;
        }
    }
    
    /* Fix sidebar positioning */
    .sidebar {
        position: fixed !important;
        right: 0 !important;
        left: auto !important;
        width: 135px !important;
        z-index: 40 !important;
    }
    
    /* Profile container adjustments */
    .profile-container {
        padding-right: 0;
        margin-right: 0;
    }
    
    @media (min-width: 1024px) {
        .profile-container {
            padding-right: 0;
            margin-right: 0;
        }
    }
</style>
{% endblock %}

{% block main %}
<div class="min-h-screen relative" style="background-color: var(--bg-color); transition: background-color 0.3s;">
    <!-- Main Content with proper sidebar margin -->
    <div class="main-content">
        <!-- Profile Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-blue-500 p-6 mb-6 rounded-lg shadow-md">
            <h1 class="text-2xl font-bold text-white mb-2">{{ user.name|capfirst }} {{ user.lastname|capfirst }}</h1>
            <p class="text-blue-100">{{ user.group|getGroupnameById }}</p>
        </div>
        
        <!-- Profile Content -->
        <div class="container mx-auto px-4 sm:px-6 mb-8">
            <div class="items-center flex flex-wrap filter-bar w-full h-auto p-[10px] text-right float-right text-sm 2xl:w-1/2 xl:w-1/2 lg:w-1/2 md:w-full sm:w-full">

                <div class="w-full 2xl:w-2/5 xl:w-2/5 lg:w-2/5 md:w-2/5 sm:w-2/5 h-[288px] my-0 mx-[20px] float-right  flex flex-col gap-1 rtl">
                    <label>نام کاربری: </label>
                    <input type="text" class="w-4/5 h-5 text-gray-500 text-xs" value="{{ user.username|capfirst }}" disabled
                           readonly>
                    <label> نام:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs" value="{{ user.name|capfirst }}" disabled
                           readonly>
                    <label>نام خانوادگی: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs" value="{{ user.lastname|capfirst }}"
                           disabled readonly>
                    <label> ایمیل:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs text-left "
                           value="{{ user.email|capfirst }}" disabled readonly>
                    <label>کد ملی: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"nationalcode" }}" disabled readonly>
                </div>
                <div class="w-full 2xl:w-2/5 xl:w-2/5 lg:w-2/5 md:w-2/5 sm:w-2/5 h-[280px] my-0 mx-[20px] float-right rtl flex flex-col gap-1">
                    <label>نقش: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.group|getGroupnameById }}" disabled readonly>
                    <label> داخلی:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs" value="{{ user.extension }}" disabled
                           readonly>
                    <label for="gender">جنسیت: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"gender"|getValueOfIndexes:"gender" }}" disabled readonly>
                    <label> تاریخ تولد:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs "
                           value="{{ user.username|getFieldOfInfo:"birthdate" }}" disabled readonly>
                    <label>وضعیت ایمیل: </label>
                    {% if not user.email_verified_at %}
                        <form method="post">
                            {% csrf_token %}
                            {% if not email %}
                                <input type="submit"
                                       class="w-3/5 h-[30px] bg-blue-400 text-white text-sm border-none rounded-md"
                                       value="تایید ایمیل" name="verifyEmail">
                            {% else %}
                                <button type="button" id="verify"
                                        class="w-3/5 h-[30px] bg-blue-400 text-white text-sm border-none rounded-md">
                                    تایید ایمیل
                                </button>
                            {% endif %}
                        </form>
                    {% else %}
                        <input type="text" class="w-4/5 h-5  text-gray-500 text-xs "
                               value="فعال" disabled readonly>
                    {% endif %}

                </div>
                <div class=" w-4/5 2xl:w-3/4 xl:w-3/4 lg:w-3/4 md:1/2 h-[100px] float-right rtl flex flex-col gap-1 text-sm mr-[22px]">
                    <label>آدرس: </label>
                    <textarea type="text" class="w-full h-[70px] text-gray-500 text-xs" disabled
                              readonly>{{ user.username|getFieldOfInfo:"address" }}</textarea>
                </div>

            </div>

            <div class="w-full h-[300px] p-[10px] flex flex-wrap float-right text-sm 2xl:w-1/2 xl:w-1/2 lg:w-1/2 md:w-full sm:w-full">

                <div class="w-full 2xl:w-2/5 xl:w-2/5 lg:w-2/5 md:w-2/5 sm:w-2/5 h-[288px] my-0 mx-[20px] float-right  flex flex-col gap-1">
                    <label>وضعیت سربازی: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"military"|getValueOfIndexes:"military" }}" disabled readonly>
                    <label> استان:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"province"|getValueOfIndexes:"province" }}" disabled readonly>
                    <label>شهر: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"city" }}" disabled readonly>
                    <label> مدرک:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"educationdegree"|getValueOfIndexes:"degree" }}" disabled readonly>
                    <label>شماره کارت: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"cardnumber" }}" disabled readonly>
                    <label>شماره حساب: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"accountnumber" }}" disabled readonly>
                </div>
                <div class="w-full 2xl:w-2/5 xl:w-2/5 lg:w-2/5 md:w-2/5 sm:w-2/5 h-[288px] my-0 mx-[20px] float-right flex flex-col gap-1 ">
                    <label>شماره شبا: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"accountnumbershaba" }}" disabled readonly>
                    <label> شماره همراه:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"phonenumber" }}" disabled readonly>
                    <label>زمینه مدرک:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"educationfield" }}" disabled readonly>
                    <label> تلفن:</label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"telephone" }}" disabled readonly>
                    <label>وضعیت تاهل: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs"
                           value="{{ user.username|getFieldOfInfo:"maritalstatus"|getValueOfIndexes:"marital" }}" disabled readonly>

                    <label>وضعیت حساب: </label>
                    <input type="text" class="w-4/5 h-5  text-gray-500 text-xs "
                           value="{% if user.active %}فعال{% else %}غیر فعال{% endif %}" disabled readonly>
                </div>
            </div>
            

            </div>
        </div>
    </div>
</div>

{% if email %}
        <div id="emailMod"
             class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-75 z-50 {% if not email %}hidden{% endif %}">
            <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
                <div class="p-6 text-center">
                    <div class="flex items-center justify-center w-12 h-12 mx-auto rounded-full">
                        <i class="fa-solid fa-envelope text-4xl"></i>
                    </div>
                    <p>لطفا کد ارسال شده را وارد کنید</p>
                    <form method="POST" class="mt-1">
                        {% csrf_token %}
                        <input type="number" name="code" class="mt-2 rounded" placeholder="کد">
                        <div class="px-6 pt-5 justify-end gap-2">
                            <input type="submit" name="resend" value="ارسال مجدد کد" class="px-4 py-2 bg-blue-400 rounded-md text-white hover:bg-blue-500 text-sm">
                        </div>
                        <div class="px-6 pt-5 justify-end gap-2">
                            <button type="button" id="cancel"
                                    class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 ">لغو
                            </button>
                            <input type="submit" id="confirm" class="hidden" name="verify">
                            <label for="confirm"
                                   class="px-4 py-2 bg-green-600 rounded-md text-white hover:bg-green-500">تایید</label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    {% endif %}
    {% if email %}
    <!-- Email verification is available -->  
    <script>
        // Wait for document to be ready
        $(document).ready(function() {
            // Handle cancel button click
            $("#cancel").on('click', function() {
                $("#emailMod").toggleClass("hidden");
            });
            
            // Handle verify button click
            $("#verify").on('click', function() {
                $("#emailMod").toggleClass("hidden");
            });
        });
    </script>
    {% else %}
    <!-- No email verification needed -->  
    <script>
        // Wait for document to be ready
        $(document).ready(function() {
            // Handle cancel button click
            $("#cancel").on('click', function() {
                $("#emailMod").toggleClass("hidden");
            });
        });
    </script>
    {% endif %}
{% endblock %}